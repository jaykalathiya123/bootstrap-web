import React from "https://cdn.skypack.dev/react";
import ReactDOM from "https://cdn.skypack.dev/react-dom";

/**
 * NOTE: Put the vector path through a tool like
 * https://yoksel.github.io/relative-clip-path to make it
 * relative to the element
 *
 * Using inline SVGs instead of external files due to
 * a known issue in Chrome regarding SVGs as clip-paths
 */
const morphs = [
  // First shape
  `M0.412,0.004 C0.496,0.007,0.579,0.033,0.651,0.075 C0.72,0.115,0.789,0.168,0.818,0.241 C0.845,0.312,0.772,0.395,0.802,0.466 C0.839,0.556,0.992,0.584,1,0.681 C1,0.765,0.907,0.827,0.835,0.876 C0.77,0.921,0.687,0.925,0.61,0.948 C0.544,0.968,0.482,1,0.412,1 C0.343,0.998,0.292,0.943,0.228,0.919 C0.158,0.893,0.057,0.915,0.017,0.855 C-0.025,0.791,0.039,0.709,0.039,0.634 C0.039,0.576,0.022,0.522,0.018,0.465 C0.013,0.391,-0.015,0.315,0.011,0.244 C0.038,0.169,0.095,0.102,0.166,0.06 C0.238,0.017,0.327,0.002,0.412,0.004`,
  // Second shape
  `M0.545,0.068 C0.618,0.064,0.684,-0.011,0.756,0.008 C0.826,0.027,0.873,0.1,0.91,0.166 C0.945,0.229,0.959,0.302,0.963,0.375 C0.966,0.442,0.926,0.504,0.93,0.572 C0.937,0.673,1,0.768,0.997,0.863 C0.967,0.948,0.863,0.982,0.78,1 C0.701,1,0.622,0.985,0.545,0.963 C0.48,0.945,0.424,0.909,0.362,0.883 C0.296,0.854,0.223,0.845,0.167,0.8 C0.104,0.749,0.046,0.685,0.02,0.605 C-0.007,0.524,0.006,0.434,0.019,0.349 C0.032,0.26,0.035,0.157,0.097,0.096 C0.161,0.034,0.259,0.037,0.344,0.032 C0.413,0.028,0.476,0.072,0.545,0.068`,
  // Third shape
  `M0.513,0.017 C0.582,0.034,0.629,0.094,0.689,0.132 C0.742,0.166,0.803,0.186,0.849,0.229 C0.898,0.276,0.939,0.329,0.965,0.392 C0.992,0.459,1,0.531,1,0.603 C0.997,0.683,0.987,0.765,0.946,0.834 C0.902,0.906,0.843,0.985,0.76,1 C0.672,1,0.599,0.93,0.513,0.908 C0.449,0.892,0.384,0.902,0.32,0.888 C0.244,0.871,0.157,0.87,0.099,0.819 C0.04,0.767,-0.005,0.686,0.002,0.609 C0.009,0.528,0.096,0.48,0.135,0.408 C0.162,0.356,0.174,0.299,0.196,0.245 C0.226,0.173,0.224,0.078,0.288,0.033 C0.349,-0.012,0.439,-0.001,0.513,0.017`,
  // Fourth shape
  `M0.483,0.027 C0.536,0.045,0.571,0.112,0.626,0.124 C0.708,0.141,0.804,0.054,0.872,0.108 C0.933,0.156,0.896,0.271,0.917,0.352 C0.939,0.438,1,0.511,1,0.601 C0.991,0.69,0.938,0.776,0.871,0.821 C0.803,0.866,0.716,0.821,0.64,0.842 C0.583,0.858,0.539,0.907,0.483,0.929 C0.411,0.957,0.325,1,0.263,0.989 C0.195,0.932,0.248,0.798,0.218,0.708 C0.199,0.649,0.151,0.612,0.121,0.56 C0.078,0.488,0.007,0.427,0.001,0.339 C-0.004,0.253,0.037,0.167,0.091,0.106 C0.143,0.047,0.22,0.026,0.292,0.011 C0.356,-0.001,0.421,0.006,0.483,0.027`,
  // Fifth shape
  `M0.525,0.091 C0.604,0.081,0.669,-0.005,0.748,0.006 C0.826,0.018,0.906,0.074,0.942,0.152 C0.978,0.231,0.928,0.327,0.938,0.415 C0.947,0.493,1,0.566,0.995,0.639 C0.967,0.715,0.856,0.707,0.809,0.771 C0.763,0.833,0.795,0.954,0.731,0.994 C0.67,1,0.596,0.954,0.525,0.95 C0.458,0.946,0.395,0.98,0.329,0.972 C0.248,0.962,0.141,0.974,0.097,0.899 C0.051,0.819,0.143,0.713,0.125,0.621 C0.108,0.531,0.002,0.479,0.001,0.387 C-0.001,0.299,0.06,0.221,0.119,0.161 C0.175,0.104,0.25,0.072,0.325,0.059 C0.392,0.047,0.457,0.099,0.525,0.091`
];

const Morph = ({
  children,
  duration = 10,
  height = 400,
  paths = morphs,
  width = 400
}) => {
  const generateLinearKeySplines = () => {
    return paths.reduce((accumulator) => `${accumulator}0 0 1 1;`, "");
  };

  const generateValues = () => {
    const reversed = [...paths].reverse();
    reversed.shift();
    return [...paths, ...reversed].join(";");
  };

  return (
    <>
      <svg
        className="svg"
        style={{ position: "absolute", width: 0, height: 0 }}
      >
        <clipPath id="morph-clip-path-1" clipPathUnits="objectBoundingBox">
          <path d={paths[0]}>
            <animate
              attributeType="XML"
              attributeName="d"
              values={generateValues()}
              keySplines={generateLinearKeySplines()}
              dur={`${duration}s`}
              repeatCount="indefinite"
              fill="freeze"
              calcMode="linear"
            />
          </path>
        </clipPath>
      </svg>
      <div
        className="absolute"
        style={{
          height: `${height}px`,
          width: `${width}px`,
          clipPath: "url(#morph-clip-path-1)",
          background: "linear-gradient(to right, #d53369, #cbad6d)"
        }}
      >
        {children}
      </div>
    </>
  );
};

window.onload = function () {
  ReactDOM.render(<Morph />, document.getElementById("root"));
};
